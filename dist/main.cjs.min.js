"use strict";var n=function(n){return Object.prototype.toString.call(n).slice(8,-1)},r=function(n,r){return n[r]&&!n[r].n},e=function(n){var r=[],e={};Array.prototype.forEach.call(n,function(n,t){e[String(t)]=1,r.push(t)});var t=0,u=Object.keys(n).filter(function(n){return!e[n]}).concat(Object.getOwnPropertySymbols(n).filter(function(n){var r=String(n).match(/^Symbol\(Symbol\.([^\)]*)\)$/);return null===r||2!==r.length||Symbol[r[1]]!==n}));return r.concat(u).reduce(function(r,e){return e===t?(t+=1,r.e.push(n[e])):r.t.push([e,n[e]]),r},{e:[],t:[]})},t=function(r,e,t){var u=Object.keys(r).find(function(n){return r[n].u(e)});if(!u){if(t)return"ob";throw new Error('Unsupported type "'.concat(n(e),'". Encoding halted.'))}return u},u=function(n,e){void 0!==n.i.get(e)||r(n.o,t(n.o,e,n.f))||n.c.push(e)},i=function(n,i){var o=t(n.o,i,n.f);if(r(n.o,o))return o;var f=n.i.get(i);if(void 0!==f)return f.a;n[o]=n[o]||[],n[o].push(void 0);var c=n[o].length-1,a={d:o,y:c,a:o+c,_:i,e:[],t:[]};n.i.set(i,a),n.o[o].l&&n.b.push(a);var d=e(i),y=d.e,_=d.t;return n.o[o].A&&(y=[]),a.e=y,a.t=_,y.forEach(function(r){u(n,r)}),_.forEach(function(r){u(n,r[0]),u(n,r[1])}),a.a},o=function(n){return{u:function(r){return r===n},p:function(){return n}}},f=o(void 0),c=o(null),a={u:function(n){return n!=n},p:function(){return NaN}},d=o(1/0),y=o(-1/0),_={u:function(n){return 0===n&&1/n==-1/0},p:function(){return-0}},l=o(!0),v=o(!1),b=function(r,e){return{u:function(t){return n(t)===r&&!(t instanceof e)},n:function(n,r){return r._},g:function(n,r,e){return n.s[r][e]},p:function(n,r){return r._}}},A=b("Number",Number),p=b("String",String),g=function(n){return{d:n.substring(0,2),y:parseInt(n.substring(2),10)}},s=function(n,e){if(r(n.o,e))return n.o[e].p();var t=g(e);return n.o[t.d].g(n,t.d,t.y)},E=function(n,e){if(r(n.o,e))return n.o[e].p();var t=g(e);return n.o[t.d]?n.S[e]._:e},S=function(n,r,e){e.forEach(function(e){r._[E(n,e[0])]=E(n,e[1])})},m=function(n,r){S(n,r,r.m.slice(1))},w=function(r){return function(e){return n(e)===r}},U=function(n,r,e){return{u:w(n),n:r,g:e,p:m}},R=U("Symbol",function(n,r){var e=Symbol.keyFor(r._),t=void 0!==e;return[i(n,t?1:0),i(n,t?e:String(r._).slice(7,-1))]},function(n,r,e){var t=n.s[r][e],u=s(n,t[1]);return 1===s(n,t[0])?Symbol.for(u):Symbol(u)}),F=function(n,r){return[r.e.map(function(r){return i(n,r)})]},I=function(n,r){return{u:w(n),n:F,g:r,p:function(n,r){r.m[0].forEach(function(e,t){r._[t]=E(n,e)}),m(n,r)}}},B=I("Array",function(){return[]}),h=I("Arguments",function(n,r,e){return function(){return arguments}.apply(null,Array.from({length:n.s[r][e][0].length},function(){}))}),O={u:w("Object"),n:function(){return[]},g:function(){return{}},p:function(n,r){S(n,r,r.m)}},j=function(r,e){return{u:function(t){return n(t)===r&&t instanceof e},n:function(n,r){return[i(n,r._.valueOf())]},g:function(n,r,t){return new e(s(n,n.s[r][t][0]))},p:m}},x=j("Boolean",Boolean),V=j("Number",Number),M=Object.assign({A:1},j("String",String)),N=j("Date",Date),k=U("RegExp",function(n,r){return[[i(n,r._.source),i(n,r._.flags),i(n,r._.lastIndex)]]},function(n,r,e){var t=n.s[r][e][0],u=new RegExp(s(n,t[0]),s(n,t[1]));return u.lastIndex=s(n,t[2]),u}),C={EvalError:EvalError,RangeError:RangeError,ReferenceError:ReferenceError,SyntaxError:SyntaxError,TypeError:TypeError,URIError:URIError},T=U("Error",function(n,r){return[[i(n,C[r._.name]?r._.name:"Error"),i(n,r._.message),i(n,r._.stack)]]},function(n,r,e){var t=n.s[r][e][0],u=new(C[s(n,t[0])]||Error)(s(n,t[1]));return u.stack=s(n,t[2]),u}),D=function(n,r){return{u:w(n),n:function(n,r){return r.e=Array.from(new Uint8Array(r._)),F(n,r)},g:function(n,e,t){var u=n.s[e][t][0],i=new r(u.length),o=new Uint8Array(i);return u.forEach(function(r,e){o[e]=s(n,r)}),i},p:m}},$=D("ArrayBuffer",ArrayBuffer),q=D("SharedArrayBuffer",SharedArrayBuffer),z=function(n,r){return I(n,function(n,e,t){return new r(n.s[e][t][0].length)})},G=z("Int8Array",Int8Array),H=z("Uint8Array",Uint8Array),J=z("Uint8ClampedArray",Uint8ClampedArray),K=z("Int16Array",Int16Array),L=z("Uint16Array",Uint16Array),P=z("Int32Array",Int32Array),Q=z("Uint32Array",Uint32Array),W=z("Float32Array",Float32Array),X=z("Float64Array",Float64Array),Y=function(n,r,e,t){return{u:w(n),n:function(n,r){return[Array.from(r._).map(function(r){return e(n,r)})]},g:function(){return new r},p:function(n,r){r.m[0].forEach(function(e){t(n,r._,e)}),m(n,r)}}},Z=Y("Set",Set,function(n,r){return i(n,r)},function(n,r,e){r.add(E(n,e))}),nn=Y("Map",Map,function(n,r){return[i(n,r[0]),i(n,r[1])]},function(n,r,e){r.set(E(n,e[0]),E(n,e[1]))}),rn=function(n,r,e){return{u:w(n),n:function(n,e){return[[new Uint8Array(0)].concat(r.map(function(r){return i(n,e._[r])}))]},l:function(n,r,e){var t=new FileReader;t.addEventListener("loadend",function(){var u=new Uint8Array(t.result),o=i(n,u),f=g(o);n[f.d][f.y]=[Array.from(u).map(function(r){var e=i(n,r),t=g(e);return n[t.d][t.y]=r,e})],n[r.d][r.y][0][0]=o,e()}),t.readAsArrayBuffer(r._)},g:function(n,r,t){var u=n.s[r][t][0],i=g(u[0]);return e(n,[new Uint8Array(n.s[i.d][i.y][0].map(function(r){return s(n,r)}))],u)},p:m}},en=rn("Blob",["type"],function(n,r,e){return new Blob(r,{type:s(n,e[1])})}),tn=rn("File",["name","type","lastModified"],function(n,r,e){return new File(r,s(n,e[1]),{type:s(n,e[2]),lastModified:s(n,e[3])})}),un={un:f,nl:c,na:a,pI:d,nI:y,n0:_,bt:l,bf:v,nm:A,st:p,sy:R,ar:B,ag:h,ob:O,BO:x,NM:V,ST:M,da:N,re:k,er:T,AB:$,SA:q,I1:G,U1:H,C1:J,I2:K,U2:L,I3:P,U3:Q,F3:W,F4:X,Se:Z,Ma:nn,Bl:en,Fi:tn},on=function(r,e){var t="Function"===n(r.w)?r.w:void 0;(r=Object.keys(r).reduce(function(n,e){return"_"!==e[0]&&(n[e]=r[e]),n},{})).r=e,r.v="1.0.0";var u=Object.keys(r).map(function(n){return[n,r[n]]});if(!t)return u;t(u)},fn=function(e,t){var u={f:(t=t||{}).safeMode,w:t.onFinish,o:un,i:new Map,c:[],b:[]},o=i(u,e);if(r(un,o))return on(u,o);for(u.c.push(e);u.c.length;)i(u,u.c.shift());if(u.i.forEach(function(n){u[n.d][n.y]=un[n.d].n(u,n),n.t.length>0&&(u[n.d][n.y]=u[n.d][n.y].concat(n.t.map(function(n){return[i(u,n[0]),i(u,n[1])]})))}),!(u.b.length>0))return on(u,u.i.get(e).a);if("Function"!==n(u.w)){if(u.f)return on(u,u.i.get(e).a);throw new Error("Encoded value contained a deferred type (File and Blob), but no `options.onFinish` function provided.")}var f=u.b.length,c=function(){if(0===(f-=1))return on(u,u.i.get(e).a)};u.b.forEach(function(n){un[n.d].l(u,n,c)})},cn=function r(e,t){"Array"===n(t)?t.forEach(function(n){r(e,n)}):e.c.push(t)},an=function(e,t){var u=g(t);if(un[u.d]&&void 0===e.S[t]&&!r(un,u.d)){var i={d:u.d,y:u.y,a:t,_:void 0,m:[]};e.S[t]=i,i._=un[u.d].g(e,i.d,i.y),i.m=e.s[i.d][i.y],"Array"===n(i.m)&&cn(e,i.m)}},dn=function(n){var e={o:un,s:n.reduce(function(n,r){return n[r[0]]=r[1],n},{}),S:{},c:[]},t=g(e.s.r);if(!un[t.d])return e.s.r;if(r(un,t.d))return un[t.d].p();for(e.c.push(e.s.r);e.c.length;)an(e,e.c.shift());return Object.values(e.S).forEach(function(n){un[n.d].p(e,n)}),e.S[e.s.r]._},yn={encode:fn,decode:dn};module.exports=yn;